# ============================================================
# FILE: .github/workflows/render-health-check.yml
#
# PURPOSE:
#   Monitor Render app health every 10 minutes
#   Send email alert ONLY when app is DOWN
#
# WHAT YOU MUST DO:
#   - Replace email addresses with YOUR emails
#   - Add GitHub Secrets (shown below)
#
# ============================================================

name: Render App Health Check

on:
  # Run every 10 minutes
  schedule:
    - cron: "*/10 * * * *"

  # Allow manual run from GitHub UI
  workflow_dispatch:

jobs:
  monitor:
    runs-on: ubuntu-latest

    steps:
      # ------------------------------------------------------
      # STEP 1: Ping Render App
      # ------------------------------------------------------
      - name: Ping Render App
        run: |
          STATUS=$(curl -s -o /dev/null -w "%{http_code}" https://YOUR_RENDER_APP_URL.onrender.com)
          echo "HTTP status: $STATUS"

          if [ "$STATUS" -ne 200 ]; then
            echo "APP_DOWN=true" >> $GITHUB_ENV
          else
            echo "APP_DOWN=false" >> $GITHUB_ENV
          fi

      # ------------------------------------------------------
      # STEP 2: Send Email ONLY if App is DOWN
      # ------------------------------------------------------
      - name: Send email if app is DOWN
        if: env.APP_DOWN == 'true'
        uses: dawidd6/action-send-mail@v3
        with:
          # Gmail SMTP configuration
          server_address: smtp.gmail.com
          server_port: 587

          # üîê AUTHENTICATION (FROM GitHub Secrets)
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}

          # üìß EMAIL CONTENT
          subject: "‚ùå Render App DOWN"
          body: |
            ALERT üö®

            Your Render app is NOT responding.

            App URL:
            https://YOUR_RENDER_APP_URL.onrender.com

            Time:
            GitHub Actions detected a failure.

          # üì¨ RECIPIENT (PUT YOUR EMAIL HERE)
          to: YOUR_RECEIVER_EMAIL@gmail.com

          # ‚úâÔ∏è DISPLAY NAME OF SENDER
          from: Render App Monitor

# ============================================================
# GITHUB SECRETS YOU MUST ADD (VERY IMPORTANT)
# ============================================================
#
# Go to:
# GitHub Repo ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions
#
# ADD THESE SECRETS:
#
# 1) EMAIL_USERNAME
#    Value example:
#    alerts.yourname@gmail.com
#
# 2) EMAIL_PASSWORD
#    Value example:
#    abcd efgh ijkl mnop   (GMAIL APP PASSWORD)
#
# ‚ö†Ô∏è DO NOT USE NORMAL GMAIL PASSWORD
# ‚ö†Ô∏è ENABLE 2-STEP VERIFICATION IN GMAIL
#
# ============================================================
# WHAT GOES WHERE (FINAL CLARITY)
# ============================================================
#
# IN CODE (SAFE):
# - to: YOUR_RECEIVER_EMAIL@gmail.com
# - subject
# - body
# - app URL
#
# IN GITHUB SECRETS (SENSITIVE):
# - EMAIL_USERNAME
# - EMAIL_PASSWORD
#
# ============================================================
# FINAL SUMMARY
# ============================================================
# ‚úî Runs every 10 minutes
# ‚úî Manual run supported
# ‚úî No email spam (only on DOWN)
# ‚úî Secrets are secure
# ‚úî Production-grade monitoring
#
# ============================================================
